# Reddit Insight Tool 框架文档

## 一、项目概述

Reddit Insight Tool 是一个基于 Reddit API 的社区话题筛选与分析工具，旨在帮助用户快速发现和深入理解 Reddit 社区中的热门话题、用户痛点和讨论热点。本项目采用现代化的技术栈构建，提供直观友好的用户界面和强大的数据分析能力。项目采用模块化的功能架构，将话题选择和分析功能分离到不同的功能模块中，每个模块包含其专属的组件、钩子函数和工具函数。这种架构设计确保了代码的高内聚低耦合，便于团队协作开发和后续功能扩展。项目的核心价值在于将复杂的自然语言处理技术封装成简单易用的功能，让用户无需专业知识即可获取有价值的信息。

## 二、技术栈

本项目采用当前业界主流的前端技术栈构建，确保了开发效率和运行性能的平衡。后端框架选用 Next.js 14+，充分利用其 App Router 架构实现服务端渲染和静态生成，提升首屏加载速度和搜索引擎优化效果。开发语言为 TypeScript，通过静态类型检查在编译阶段发现潜在错误，提高代码质量和可维护性。样式方案采用 Tailwind CSS，结合原子化设计理念实现快速样式开发，同时配合 Shadcn/UI 组件库提供一致的设计语言和丰富的交互组件。

测试方面使用 Jest 和 React Testing Library 构建单元测试体系，确保核心业务逻辑的可靠性。容器化部署基于 Docker，采用多阶段构建优化镜像大小，最终产出约 100MB 的精简镜像。Reddit API 交互模块实现了请求取消机制和指数退避重试策略，有效处理网络异常和 API 限流情况。NLP 处理模块集成了中文和英文的自然语言处理能力，支持情感分析、关键词提取和洞察检测等高级功能。

## 三、架构设计

### 3.1 目录结构

项目采用功能导向的目录结构组织代码，将相关功能的组件、钩子和工具函数集中在同一目录下。这种结构便于开发者快速定位和理解特定功能的实现，同时也简化了模块复用和测试的流程。根目录下包含配置文件、依赖定义和部署相关文件。src 目录是主要的源代码入口，下设 app、components、features 和 lib 四个核心目录。

app 目录遵循 Next.js App Router 规范，包含页面路由、布局组件和全局样式。components 目录存放通用 UI 组件，这些组件不依赖特定业务逻辑，可在项目各处复用。features 目录按功能模块划分，每个子目录代表一个独立的功能域，包含该功能所需的全部组件、钩子和类型定义。lib 目录包含工具函数、类型定义和外部服务封装等基础支撑代码。

### 3.2 模块关系

应用的核心模块包括话题选择模块（topic-selection）和分析模块（analysis），两者通过 React Context 和自定义钩子进行状态共享。话题选择模块负责 Reddit 数据的获取和展示，用户可以通过搜索 Subreddit 名称或帖子标题来筛选感兴趣的内容。选中目标话题后，分析模块接手进行深度处理，包括评论抓取、自然语言处理和可视化展示。

模块间的数据流转遵循单向流动原则：话题选择模块将选中的话题信息传递给分析模块，分析模块完成处理后更新全局状态供 UI 层渲染。这种设计确保了数据流向的清晰性，便于问题排查和性能优化。同时，每个模块内部采用高内聚设计，组件间通过 props 传递数据，避免了隐式依赖带来的复杂性。

## 四、核心功能模块

### 4.1 话题选择模块（topic-selection）

话题选择模块是用户与系统交互的入口，提供 Subreddit 和帖子两种维度的搜索能力。该模块包含三个核心组件：TopicSearchInput 负责接收用户输入并触发搜索；SearchSuggestions 显示搜索建议和自动补全；TopicList 展示搜索结果列表；AdvancedSearchOptions 提供时间范围、排序方式等高级筛选条件。

模块的状态管理通过两个自定义钩子实现：useTopicSearch 处理搜索逻辑和结果状态，useSearchHistory 管理用户的搜索历史记录。搜索历史采用本地存储持久化，确保用户刷新页面后仍能查看之前的搜索记录。搜索组件支持键盘导航操作，用户可以使用上下箭头选择建议项，Enter 键确认搜索，这些细节设计提升了操作效率。

### 4.2 分析模块（analysis）

分析模块负责对选中话题进行深度分析，包括评论数据获取、情感分析、关键词提取和洞察检测。该模块的入口组件是 FeatureAnalysis，它协调各子组件的工作流程。AnalysisProgress 展示分析进度和当前阶段；CommentList 展示原始评论数据；SentimentChart 可视化情感分析结果；KeywordCloud 展示高频关键词；InsightCard 呈现检测到的用户痛点和建议。

模块的核心逻辑封装在 useAnalysis 钩子中，该钩子管理整个分析流程的状态机，包括空闲、加载中、分析中、完成和错误五种状态。分析过程采用流水线设计：首先并行获取评论数据，然后对每条评论进行情感分析和关键词提取，最后汇总生成洞察报告。这种流水线架构充分利用了现代浏览器的并行处理能力，显著缩短了分析耗时。

## 五、自然语言处理模块

### 5.1 处理流程

NLP 模块是数据分析的核心引擎，其处理流程分为预处理、分析和后处理三个阶段。预处理阶段包括文本清洗、分句、分词和去停用词等操作，确保输入数据的规范性。分析阶段执行情感分析、关键词提取和洞察检测等具体任务。后处理阶段对分析结果进行聚合和排序，生成最终报告。

模块支持中英文混合处理，通过检测文本语言自动选择合适的分词器和停用词表。情感分析采用基于词典的方法，为每个情感词分配正负向权重，通过加权求和计算整体情感倾向。关键词提取综合考虑词频、逆文档频率和词性，优先提取名词和动词类关键词。洞察检测通过模式匹配识别用户反馈中的问题描述、功能建议和需求表达。

### 5.2 核心函数

nlp.ts 文件包含以下核心函数：normalizeText 标准化输入文本，处理特殊字符和格式问题；tokenize 进行中英文分词，返回词素数组；removeStopwords 过滤停用词，保留实际语义词；extractKeywords 基于 TF-IDF 变体算法提取关键词；analyzeSentiment 计算文本情感得分；detectInsights 识别洞察模式并分类。所有函数均经过单元测试覆盖，确保处理结果的稳定性和准确性。

## 六、Reddit API 客户端

### 6.1 客户端功能

API 客户端模块（reddit.ts）封装了所有与 Reddit API 的交互逻辑，对上层业务代码隐藏了网络请求、错误处理和认证管理等复杂性。客户端支持获取 Subreddit 信息、搜索帖子、获取评论和解析响应数据等核心操作。每个 API 方法都返回 Promise，便于在异步流程中使用。

客户端实现了请求超时控制，默认超时时间为 10 秒，避免长时间等待无响应请求。通过 AbortSignal 支持请求取消，当用户切换搜索目标时，正在进行的请求会被自动取消，释放网络资源和浏览器性能。这一机制有效避免了竞态条件导致的数据混乱问题。

### 6.2 错误处理与限流应对

Reddit API 对请求频率有限制，当超过速率限制时返回 429 状态码。客户端实现了智能重试机制：首次遇到 429 错误时等待 1 秒后重试，若仍受限则指数级增加等待时间，最多重试 5 次。重试期间会向用户显示友好的提示信息，告知当前正在处理网络拥塞情况。

对于其他错误类型，客户端采用分类处理策略：4xx 客户端错误记录详细错误信息并提示用户检查输入；5xx 服务器错误显示服务暂时不可用并建议稍后重试；网络断开等底层错误显示连接问题提示。所有错误都经过包装，保留原始错误信息的同时添加上下文，便于开发者定位问题。

## 七、UI 组件库

项目基于 Shadcn/UI 构建了完整的组件库，包含以下组件：Button 按钮组件支持多种变体和尺寸；Input 输入框组件支持前后图标和禁用状态；Card 卡片组件用于内容分组展示；Badge 标签组件用于状态和分类标识；Spinner 加载动画组件用于异步操作反馈；Alert 警告组件用于展示提示和错误信息；Tabs 标签页组件用于内容分组；Separator 分隔线组件用于视觉分割；Select 下拉选择组件用于选项选择；Dialog 对话框组件用于模态交互；DropdownMenu 下拉菜单组件用于右键和菜单交互；Tooltip 提示组件用于鼠标悬停信息展示；Progress 进度条组件用于任务进度可视化。

所有组件都经过样式定制以保持视觉一致性，同时保留原始组件的完整功能。组件使用 TypeScript 编写类型定义，确保调用时的类型安全。组件库的设计遵循无障碍访问标准，支持键盘导航和屏幕阅读器操作。

## 八、Docker 部署方案

### 8.1 镜像构建

项目采用 Docker 多阶段构建策略优化镜像大小。第一阶段使用 node:20-alpine 作为构建基础，安装依赖并编译 Next.js 应用；第二阶段仅复制编译产物到一个精简的运行时镜像。这种方案将最终镜像大小控制在约 100MB，相比直接使用 node 基础镜像减少了约 70% 的体积。

构建过程中启用了 Next.js 的 standalone 模式，该模式仅打包运行时必需的文件，排除了源代码和开发依赖。Dockerfile 中创建了专门的 non-root 用户（nextjs，UID 1001），容器运行时以该用户身份执行，遵循最小权限原则提升安全性。健康检查配置监控应用端口，确保服务可用性。

### 8.2 容器编排

docker-compose.yml 定义了完整的容器运行环境，包括服务配置、环境变量挂载和健康检查。生产环境配置中，应用容器通过环境变量注入配置参数，敏感信息通过 secrets 机制管理。服务依赖关系明确指定，确保数据库等依赖服务先于应用启动。

部署脚本提供了阿里云 ECS 环境的一键部署能力，包括镜像构建、推送和容器启动等步骤。部署过程中自动配置 Nginx 反向代理和 SSL 证书（需用户提前申请），确保生产环境的安全访问。日志统一输出到标准输出，方便使用 docker logs 查看和管理。

## 九、开发规范

### 9.1 命名规范

项目遵循一致的命名规范，提升代码可读性和团队协作效率。文件名采用 kebab-case 风格，如 topic-search-input、analysis-progress。组件名使用 PascalCase，如 TopicSearchInput、AnalysisProgress。自定义钩子以 use 前缀开头，如 useTopicSearch、useAnalysis。类型定义使用 PascalCase 并以 .type.ts 结尾，如 SearchResult.type.ts。

变量和函数命名采用 camelCase，常量使用全大写加下划线分隔。React 组件的 props 类型以 ComponentNameProps 命名。状态变量名称应清晰表达其含义，避免使用无意义的命名如 data、info。API 相关的类型定义集中放置在 lib/types.ts 文件中，便于全局引用和类型检查。

### 9.2 代码风格

代码风格统一使用项目预设的 Prettier 配置，不允许擅自修改格式化规则。组件文件遵循固定结构：先导入依赖，再定义类型，然后实现组件逻辑，最后导出组件。钩子函数的实现应保持纯净，避免直接修改输入参数或产生副作用。

注释规范要求所有关键代码必须添加注释说明，包括但不限于：函数目的和参数说明、复杂逻辑的思路解释、API 调用的用途和返回值处理、边界情况和特殊处理的说明。注释语言跟随项目语言规范，业务逻辑使用中文注释，API 文档和代码规范可使用英文。行内注释用于解释「为什么」而非「是什么」，避免冗余的翻译式注释。

### 9.3 安全 checklist

代码提交前必须通过以下安全检查：SQL 注入风险排查，确保所有用户输入都经过验证和转义，不使用字符串拼接构建查询；XSS 风险排查，所有用户生成的内容在渲染前必须转义处理，使用 React 默认的转义机制即可防范大部分 XSS 攻击；边界情况处理，检查空值、网络失败、超时等异常场景，确保程序不会崩溃或给出误导性结果。

依赖安全方面，定期运行 npm audit 检查已知漏洞，及时更新受影响依赖。敏感信息如 API 密钥、数据库凭证等必须存储在环境变量中，严禁写入代码仓库。生产环境配置使用 .env.production 模板，不直接提交包含真实值的配置文件。

## 十、文件统计

### 10.1 代码文件统计

截至当前版本，项目包含以下代码文件：TypeScript 组件文件（.tsx）28 个，涵盖 UI 组件、功能模块组件和测试组件；TypeScript 工具文件（.ts）10 个，包含钩子实现、API 客户端、NLP 处理和工具函数；测试文件（.test.tsx/.test.ts）5 个，覆盖核心组件和钩子的单元测试。

主要功能模块文件分布如下：话题选择模块包含 7 个组件文件、3 个钩子文件和 2 个测试文件；分析模块包含 5 个组件文件、1 个钩子文件和 1 个类型定义文件；UI 组件库包含 12 个基础组件文件；应用框架包含 4 个页面和布局文件。

### 10.2 配置文件统计

项目包含以下配置文件：package.json 定义项目依赖和 npm 脚本；next.config.mjs 配置 Next.js 构建选项；tsconfig.json 配置 TypeScript 编译选项；tailwind.config.ts 配置 Tailwind CSS 主题和变体；jest.config.js 配置 Jest 测试环境；.eslintrc.json 配置 ESLint 规则；.prettierrc 配置 Prettier 格式化规则。

部署相关配置文件包括：Dockerfile 定义多阶段构建流程；docker-compose.yml 定义容器编排配置；.dockerignore 配置构建上下文排除规则；.env.production 定义生产环境变量模板。这些配置文件共同支撑了项目的开发、测试和部署流程。

## 十一、变更日志

### v1.1.0（当前版本）

本版本完成了 Docker 容器化部署的支持，标志着项目具备了生产环境部署能力。主要变更包括：实现 Next.js standalone 构建模式，优化 Docker 镜像大小至约 100MB；配置非 root 用户运行容器，提升运行时安全性；实现健康检查和优雅重启机制，确保服务可用性；添加阿里云 ECS 部署文档和自动化脚本。

功能增强方面，优化了 Reddit API 客户端的错误处理逻辑，新增请求取消机制和指数退避重试策略；改进了 NLP 模块的分词准确性，新增中文停用词支持；更新了 UI 组件库，新增 Progress 和 Tooltip 组件；优化了搜索建议的键盘导航体验。Bug 修复包括修复了搜索历史在某些情况下无法正确加载的问题，以及修复了分析进度在网络超时后未能正确重置的问题。

### v1.0.0

初始版本发布，完成了核心功能的开发。包括话题搜索和筛选功能，支持 Subreddit 和帖子两种搜索维度；分析功能实现了评论获取、情感分析和关键词提取；洞察检测功能可识别用户反馈中的痛点和需求；UI 界面采用响应式设计，支持桌面和移动设备访问；单元测试覆盖率达到核心逻辑的 80% 以上。

本版本建立了完整的项目架构，包括功能模块划分、组件库建设、API 客户端封装和 NLP 处理模块。文档方面提供了 FRAMEWORK.md、CODE_DIRECTORY.md、README.md 和 DEPLOYMENT.md 四份文档，为开发者提供全面的参考指南。
