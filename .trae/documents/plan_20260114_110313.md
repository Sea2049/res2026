# Analysis 功能模块实现计划

## 一、任务概述
实现 Reddit Insight Tool 的 Analysis 功能模块，包括评论分析、关键词提取和痛点洞察功能。

## 二、实现步骤

### 1. 扩展类型定义 (`src/lib/types.ts`)
- 扩展 `Comment` 接口，添加情感相关字段
- 添加 `AnalysisSession` 接口，管理分析会话状态
- 添加 `SentimentComment` 接口，关联评论与情感分析结果

### 2. 创建 NLP 工具函数 (`src/lib/nlp.ts`)
- 创建英文停用词列表
- 实现文本分词和清洗函数
- 实现关键词提取函数（词频统计）
- 实现情感分析函数（基于关键词词典）
- 实现痛点识别函数（基于负面词汇和模式匹配）
- **安全检查**: 对所有用户输入进行 XSS 转义处理

### 3. 扩展 Reddit API 客户端 (`src/lib/api/reddit.ts`)
- 添加 `getCommentsBySubreddit` 方法，获取 Subreddit 热门帖子评论
- 添加 `getMultiplePostComments` 方法，并行获取多个帖子的评论

### 4. 创建 UI 组件 (`src/features/analysis/components/`)
- `KeywordCloud.tsx`: 关键词云展示组件，支持悬停查看详情
- `SentimentChart.tsx`: 情感分析图表组件（使用纯 CSS 实现柱状图）
- `InsightCard.tsx`: 洞察卡片组件，展示痛点、功能需求、赞美等信息
- `CommentList.tsx`: 评论列表组件，支持筛选、排序和高亮显示
- `AnalysisProgress.tsx`: 分析进度组件，展示当前分析阶段

### 5. 创建分析 Hook (`src/features/analysis/hooks/useAnalysis.ts`)
- 管理分析状态（加载中、进行中、已完成）
- 管理评论数据获取和缓存
- 管理分析结果（关键词、情感、洞察）
- 实现取消分析和错误处理
- **边界情况处理**: 网络失败、空数据、超时

### 6. 创建主分析组件 (`src/features/analysis/index.tsx`)
- `AnalysisDashboard`: 分析仪表板主组件
- 整合所有子组件，提供完整的分析界面
- 支持分析单个或多个主题
- 支持导出分析结果

### 7. 集成到首页 (`src/app/page.tsx`)
- 添加 AnalysisDashboard 组件
- 实现 TopicSelection 与 Analysis 的联动
- 当用户选择主题后，显示分析按钮

### 8. 更新文档 (`CODE_DIRECTORY.md`)
- 记录新增的文件和组件
- 更新文件统计信息

## 三、文件清单

| 文件路径 | 说明 |
|---------|------|
| `src/lib/nlp.ts` | NLP 工具函数 |
| `src/lib/types.ts` | 类型定义扩展 |
| `src/lib/api/reddit.ts` | API 客户端扩展 |
| `src/features/analysis/components/KeywordCloud.tsx` | 关键词云组件 |
| `src/features/analysis/components/SentimentChart.tsx` | 情感图表组件 |
| `src/features/analysis/components/InsightCard.tsx` | 洞察卡片组件 |
| `src/features/analysis/components/CommentList.tsx` | 评论列表组件 |
| `src/features/analysis/components/AnalysisProgress.tsx` | 分析进度组件 |
| `src/features/analysis/hooks/useAnalysis.ts` | 分析 Hook |
| `src/features/analysis/index.tsx` | 分析仪表板组件 |

## 四、开发规范遵循
- ✅ 所有关键代码添加中文注释
- ✅ 严格使用 TypeScript 类型
- ✅ 检查 XSS 风险（输入转义、HTML 清洗）
- ✅ 处理边界情况（空值、网络失败）
- ✅ 遵循项目命名规范（camelCase 变量，PascalCase 组件）
- ✅ 同步更新 `CODE_DIRECTORY.md`