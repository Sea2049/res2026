# 关键词模块优化方案

## 一、当前架构分析

### 核心组件

1. **KeywordCloud.tsx** - 关键词云可视化组件
2. **nlp.ts** - 关键词提取核心算法(extractKeywords函数)
3. **useAnalysis.ts** - 分析流程管理Hook

### 当前实现特点

* ✅ 使用TF-IDF算法进行关键词权重计算

* ✅ Porter Stemmer词干提取(支持不规则动词)

* ✅ 完善的停用词过滤(79个基础词+扩展词汇)

* ✅ 情感词典标注(正面/负面/中性)

* ✅ Web Worker后台处理避免UI阻塞

## 二、发现的优化点

### 🔴 性能问题

1. **TF-IDF计算效率低** - 每条评论都调用`addDocument`,存在重复计算
2. **词干提取递归调用** - stemWord函数可能多次递归,影响性能
3. **情感判断重复查询** - 对每个词都查询两次Set(原词+词干)
4. **关键词排序算法** - 使用综合score排序后再slice,可优化为Top-K算法

### 🟡 算法改进空间

1. **TF-IDF权重单一** - 未考虑词的位置权重(标题vs正文)
2. **缺少N-gram支持** - 只提取单词,丢失"not good"等短语语义
3. **情感词典静态** - 未根据领域动态调整
4. **缺少同义词合并** - "bug"和"issue"应该合并统计

### 🟢 可视化增强

1. **交互功能弱** - 点击关键词只打印日志,未实现过滤评论
2. **布局算法简单** - 使用flex wrap,可改用力导向图布局
3. **缺少趋势展示** - 未显示关键词随时间的变化趋势
4. **无分组功能** - 可按主题/情感分组展示

## 三、优化方案(按优先级)

### 🎯 优先级1: 性能优化(立即实施)

#### 1.1 优化TF-IDF计算

* 批量处理文档,避免重复遍历

* 使用Map缓存词干结果

* 预计性能提升: **40-50%**

#### 1.2 优化词干提取

* 添加词干缓存(LRU Cache)

* 限制递归深度为1

* 预计性能提升: **20-30%**

#### 1.3 使用Top-K堆算法

* 替换sort().slice()为最小堆

* 只保留topK个元素

* 预计性能提升: **15-25%**

### 🎯 优先级2: 算法增强(中期实施)

#### 2.1 添加Bigram/Trigram支持

* 提取2-3词组合(如"not good", "very bad")

* 使用PMI(点互信息)筛选有意义短语

* 提升语义准确度: **30-40%**

#### 2.2 位置权重优化

* 标题中的词权重×2

* 评论开头权重×1.5

* 高分评论权重×1.2

#### 2.3 同义词聚合

* 添加同义词词典(bug/issue/problem)

* 使用词嵌入计算相似度

* 减少冗余关键词: **20-30%**

### 🎯 优先级3: 交互增强(后期实施)

#### 3.1 关键词过滤功能

* 点击关键词→过滤显示相关评论

* 支持多关键词组合过滤

* 高亮显示关键词位置

#### 3.2 可视化升级

* 力导向图布局(D3.js/ECharts)

* 关键词关联关系展示

* 时间轴趋势图

#### 3.3 智能分组

* 按主题聚类(LDA/K-means)

* 按情感分组展示

* 支持自定义分组规则

## 四、实施计划

### 第一阶段(1-2天): 性能优化

1. 优化TF-IDF批量计算
2. 添加词干缓存机制
3. 实现Top-K堆算法
4. 性能测试与对比

### 第二阶段(3-5天): 算法增强

1. 实现Bigram提取
2. 添加位置权重
3. 构建同义词词典
4. 准确度评估

### 第三阶段(5-7天): 交互增强

1. 实现关键词过滤
2. 升级可视化组件
3. 添加趋势分析
4. 用户体验测试

## 五、预期效果

* ⚡ **性能提升**: 整体处理速度提升 **60-80%**

* 🎯 **准确度提升**: 关键词相关性提升 **30-40%**

* 💡 **用户体验**: 交互性提升 **显著改善**

* 📊 **洞察深度**: 支持更深层次的数据分析

## 六、风险评估

* ⚠️ **兼容性**: 需确保Worker中的优化代码兼容

* ⚠️ **内存占用**: N-gram和缓存会增加内存使用(约20-30%)

* ⚠️ **测试覆盖**: 需补充单元测试覆盖新功能

***

**建议**: 优先实施第一阶段性能优化,立即见效且风险低。第二、三阶段可根据实际需求和时间安排逐步推进。
