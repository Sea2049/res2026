# 洞察模块优化升级方案

## 一、核心算法优化

### 1.1 NLP 分析算法增强
- **TF-IDF 关键词提取**：替代简单的词频统计，提升关键词相关性
- **情感词典扩展**：增加领域特定词汇（科技、游戏等）
- **否定句处理增强**：支持更复杂的否定模式（"not only...but also"）
- **多语言支持**：添加中文、日文等语言的预处理支持

### 1.2 洞察检测算法改进
- **置信度计算优化**：引入贝叶斯概率模型
- **洞察去重**：基于语义相似度合并相似洞察
- **优先级排序**：根据影响范围、严重程度排序洞察
- **洞察关联分析**：建立洞察之间的关系图谱

---

## 二、UI/UX 优化

### 2.1 InsightCard 组件增强
- **性能优化**：使用 `memo` 包装组件，减少不必要的重渲染
- **交互优化**：添加展开/收起动画，支持键盘导航
- **信息增强**：显示洞察趋势（上升/下降）、影响用户数
- **操作功能**：支持洞察收藏、导出、分享

### 2.2 新增可视化组件
- **洞察关系图**：展示洞察之间的关联和依赖
- **洞察时间线**：按时间维度展示洞察变化趋势
- **洞察对比**：支持不同主题/时期的洞察对比
- **情感趋势图**：展示整体情感随时间的变化

### 2.3 筛选和搜索功能
- **多维度筛选**：按类型、置信度、关键词、时间筛选
- **智能搜索**：支持自然语言搜索洞察
- **批量操作**：批量导出、标记、过滤洞察

---

## 三、性能优化

### 3.1 前端渲染优化
- **虚拟列表**：处理大量洞察时的列表虚拟化
- **分页加载**：洞察列表的分页加载机制
- **懒加载**：洞察详情和评论的懒加载
- **缓存策略**：分析结果的本地缓存

### 3.2 后端分析优化
- **增量分析**：支持增量数据的高效重新分析
- **并行处理**：多线程并行的洞察生成
- **增量缓存**：基于变化的缓存失效策略

---

## 四、数据模型扩展

### 4.1 Insight 接口增强
```typescript
interface Insight {
  id: string;
  type: "pain_point" | "feature_request" | "praise" | "question";
  title: string;
  description: string;
  confidence: number;
  relatedComments: string[];
  keyword?: string;
  count?: number;
  // 新增字段
  trend?: "up" | "down" | "stable";  // 趋势
  impactScore?: number;               // 影响评分
  severity?: "low" | "medium" | "high" | "critical";  // 严重程度
  tags?: string[];                   // 标签
  relatedInsights?: string[];        // 关联洞察
  createdAt?: number;                // 创建时间
  sourceTopics?: string[];           // 来源主题
}
```

### 4.2 新增类型定义
- `InsightTrend`：洞察趋势数据
- `InsightRelation`：洞察关联关系
- `InsightFilter`：洞察筛选条件

---

## 五、代码结构优化

### 5.1 重构建议
- **提取常量**：将类型标签、描述等提取为常量
- **工具函数**：抽取通用的格式化函数
- **组件拆分**：将 InsightCard 拆分为更小的可复用组件
- **Hook 抽象**：创建 `useInsight` Hook 管理洞察状态

### 5.2 新增文件结构
```
src/features/analysis/
├── components/
│   ├── InsightCard.tsx      # 优化现有组件
│   ├── InsightGraph.tsx     # 新增：洞察关系图
│   ├── InsightTimeline.tsx  # 新增：洞察时间线
│   └── InsightFilters.tsx   # 新增：筛选组件
├── hooks/
│   ├── useInsight.ts        # 新增：洞察相关 Hook
│   └── useInsightTrend.ts   # 新增：趋势分析 Hook
├── utils/
│   ├── insightFormatter.ts  # 新增：格式化工具
│   └── insightAnalyzer.ts   # 新增：分析工具
└── types/
    └── insight.ts           # 新增：洞察相关类型
```

---

## 六、测试覆盖

### 6.1 单元测试
- 洞察检测算法的单元测试
- 置信度计算的验证测试
- 组件渲染测试

### 6.2 集成测试
- 端到端的洞察生成流程测试
- 性能基准测试

---

## 实施优先级

| 优先级 | 任务 | 预估工时 |
|--------|------|----------|
| P0 | InsightCard 性能优化（memo） | 2h |
| P0 | 置信度计算优化 | 4h |
| P1 | 洞察趋势分析 | 6h |
| P1 | 洞察筛选和搜索 | 4h |
| P1 | 洞察关系图组件 | 8h |
| P2 | TF-IDF 算法实现 | 8h |
| P2 | 多语言支持 | 6h |
| P3 | 增量分析支持 | 12h |